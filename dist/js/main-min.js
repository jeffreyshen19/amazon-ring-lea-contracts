function drawTimeSeries(t,e,a){let i=10,s=50,n=25,r=50,d=250-i-n,o=document.getElementById("time-series").offsetWidth-r-s,c=d3.select("#time-series").select("svg").attr("width",o+r+s).attr("height",d+i+n).style("display","block").select("g").attr("transform","translate("+r+","+i+")"),l=d3.scaleTime().range([0,o]),u=d3.scaleLinear().range([d,0]);l.domain(e),u.domain(a);let m=d3.line().x(function(t){return l(t.date)}).y(function(t){return u(t.y)});c.select(".line").data([t]).attr("d",m);let h=d3.axisBottom(l).tickFormat(d3.timeFormat("%m/%Y")).ticks(d3.timeMonth.every(6)),p=d3.axisLeft(u);c.select(".xAxis").attr("transform","translate(0,"+d+")").call(h),c.select(".yAxis").call(p),c.select(".yAxisLabel").attr("transform","rotate(-90)").attr("y",0-r).attr("x",0-d/2).attr("dy","1em");let f=d3.bisector(function(t){return t.date}).left,v=d3.select("circle"),g=d3.select(".tooltip"),y=d3.timeFormat("%B %Y");c.select("rect").attr("width",o).attr("height",d).on("mouseover",function(){v.attr("visibility","visible"),g.attr("visibility","visible")}).on("mouseout",function(){v.attr("visibility","hidden"),g.attr("visibility","hidden")}).on("mousemove",function(){let e=l.invert(d3.mouse(this)[0]),a=f(t,e,1),i=t[a-1],s=t[a],n=e-i.date>s.date-e?s:i;v.attr("cx",l(n.date)).attr("cy",u(n.y)),g.attr("x",l(n.date)+160>o?l(n.date)-170:l(n.date)+10).attr("y",u(n.y)-25).select(".box").html(`\n          <p class = "heading">${y(n.date)}</p>\n          <p>New Agencies: ${n.y}</p>\n        `)})}function getSummaryStatistics(t,e,a){$("#last-updated").text(Math.round((new Date-new Date(t.snapshot.date))/36e5)),$("#statistic-lea").text(d3.format(",")(t.snapshot.agencies)),$("#statistic-video-requests").text(d3.format(",")(t.snapshot.videoRequests)),$("#statistic-states").text(Object.keys(e).length),$("#statistic-this-month").text(a)}function getUpdates(t){let e=d3.timeFormat("%m/%d/%Y");d3.select("#updates").selectAll("li").data(t).enter().append("li").html(function(t){return`\n          ${t.text}\n          <p class = "heading">${e(t.date)}</p>\n        `})}function drawMap(){}$.getJSON("http://127.0.0.1:3000/",function(t){console.log(t);let e={},a={},i=[];t.agencies.forEach(function(t){t.activeDate=new Date(t.activeDate);let s=new Date(t.activeDate.getFullYear(),t.activeDate.getMonth());s in e||(e[s]=0),e[s]+=1;let n=t.address.split(", ")[1];a[n]=!0,t.activeDate.getFullYear()>=2020&&null==t.deactivateDate&&i.push({date:t.activeDate,text:`${t.name} (${n}) added a contract with Ring`})}),t.snapshot.obsolete.forEach(function(e){i.push({date:new Date(t.snapshot.date),text:`${e.name} (${e.address.split(", ")[1]}) removed their contract with Ring`})}),t.snapshot.update.forEach(function(e){e.videoRequests>e.prevVideoRequests&&i.push({date:new Date(t.snapshot.date),text:`${e.name} (${e.address.split(", ")[1]}) requested ${e.videoRequests-e.prevVideoRequests} video${e.videoRequests-e.prevVideoRequests==1?"":"s"}`})}),i=i.sort(function(t,e){return e.date-t.date}).slice(0,4);let s=new Date,n=new Date(s.getFullYear(),s.getMonth()),r=n in e?e[n]:0;e=Object.keys(e).map(function(t){return{date:new Date(t),y:e[t]}}).sort(function(t,e){return t.date-e.date});let d,o=d3.extent(e,function(t){return t.date}),c=[0,d3.max(e,function(t){return t.y})+20];drawTimeSeries(e,o,c),getSummaryStatistics(t,a,r),getUpdates(i),drawMap(),$(window).resize(function(){clearTimeout(d),d=setTimeout(function(){drawTimeSeries(e,o,c)},100)})});