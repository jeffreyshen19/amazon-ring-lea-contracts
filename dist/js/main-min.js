function drawTimeSeries(t,e,a){let i=10,n=20,s=25,r=50,o=250-i-s,c=document.getElementById("time-series").offsetWidth-r-n,d=d3.select("#time-series").select("svg").attr("width",c+r+n).attr("height",o+i+s).style("display","block").select("g").attr("transform","translate("+r+","+i+")"),l=d3.scaleTime().range([0,c]),m=d3.scaleLinear().range([o,0]);l.domain(e),m.domain(a);let u=d3.line().x(function(t){return l(t.date)}).y(function(t){return m(t.y)});d.select(".line").data([t]).attr("d",u);let f=d3.axisBottom(l).tickFormat(d3.timeFormat("%m/%Y")).ticks(d3.timeMonth.every(6)),y=d3.axisLeft(m);d.select(".xAxis").attr("transform","translate(0,"+o+")").call(f),d.select(".yAxis").call(y),d.select(".yAxisLabel").attr("transform","rotate(-90)").attr("y",0-r).attr("x",0-o/2).attr("dy","1em");let h=d3.bisector(function(t){return t.date}).left,g=d3.select("circle"),x=d3.select(".tooltip"),v=d3.timeFormat("%B %Y");d.select("rect").attr("width",c).attr("height",o).on("mouseover",function(){g.attr("visibility","visible"),x.attr("visibility","visible")}).on("mouseout",function(){g.attr("visibility","hidden"),x.attr("visibility","hidden")}).on("mousemove",function(){let e=l.invert(d3.mouse(this)[0]),a=h(t,e,1),i=t[a-1],n=t[a],s=e-i.date>n.date-e?n:i;g.attr("cx",l(s.date)).attr("cy",m(s.y)),x.attr("x",l(s.date)+160>c?l(s.date)-170:l(s.date)+10).attr("y",m(s.y)-25).select(".box").html(`\n          <p class = "heading">${v(s.date)}</p>\n          <p>New Agencies: ${s.y}</p>\n        `)})}function getSummaryStatistics(t,e,a){$("#last-updated").text(Math.round((new Date-new Date(t.snapshot.date))/36e5)),$("#statistic-lea").text(d3.format(",")(t.snapshot.agencies)),$("#statistic-video-requests").text(d3.format(",")(t.snapshot.videoRequests)),$("#statistic-states").text(Object.keys(e).length),$("#statistic-this-month").text(a)}$.getJSON("http://127.0.0.1:3000/",function(t){console.log(t);let e={},a={};t.agencies.forEach(function(t){t.activeDate=new Date(t.activeDate);let i=new Date(t.activeDate.getFullYear(),t.activeDate.getMonth());i in e||(e[i]=0),e[i]+=1,a[t.address.split(", ")[1]]=!0});let i=new Date,n=new Date(i.getFullYear(),i.getMonth()),s=n in e?e[n]:0;e=Object.keys(e).map(function(t){return{date:new Date(t),y:e[t]}}).sort(function(t,e){return t.date-e.date});let r,o=d3.extent(e,function(t){return t.date}),c=[0,d3.max(e,function(t){return t.y})+20];drawTimeSeries(e,o,c),getSummaryStatistics(t,a,s),$(window).resize(function(){clearTimeout(r),r=setTimeout(function(){drawTimeSeries(e,o,c)},100)})});